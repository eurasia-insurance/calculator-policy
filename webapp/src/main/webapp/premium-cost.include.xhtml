<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:comp="http://xmlns.jcp.org/jsf/composite"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

	<c:set var="plc" value="#{policy.value}" />

	<p:defaultCommand target="cmdCalculateCost" />
	<h:panelGrid columns="2">
		<p:commandButton id="cmdCalculateCost"
			value="#{gpovts['command.calculate-cost']}" process="@form"
			update="@form"
			oncomplete="handleDialogShow(xhr, status, args, PF('costDialog'))" />
		<p:commandButton id="cmdReset" value="Новый расчет" process="@this"
			update="@form" action="#{actionFacade.doInitialize}" />
	</h:panelGrid>

	<p:dialog header="#{gpovts['title.policy-cost']}"
		widgetVar="costDialog" resizable="false" modal="true" width="400"
		height="300" closeOnEscape="true" id="costDialog">
		<h:panelGroup styleClass="policyCostLabel">
			<h:outputText value="#{gpovts['label.output.policy-cost']}" />
		</h:panelGroup>
		<h:outputText styleClass="policyCost"
			value="#{plc.calculation.premiumCost}">
			<f:convertNumber type="currency" locale="kk_KZ" maxFractionDigits="0"
				groupingUsed="true" currencySymbol="&#8376;" />
		</h:outputText>

		<h:panelGroup styleClass="policyCostLabel">
			<h:outputText
				value=" #{gpovts['label.output.policy-cost-with-discount']} " />
			<p:spinner id="dicountValue"
				value="#{discountData.discountPercentValue}" stepFactor="5"
				max="100" min="0" suffix="%" size="4">
				<p:ajax process="@this" update="discountCost,discountValueMessage" />
			</p:spinner>
		</h:panelGroup>

		<h:panelGroup styleClass="policyCostLabel" id="discountValueMessage">
			<p:message for="dicountValue" display="text" />
		</h:panelGroup>

		<h:outputText styleClass="policyCost" id="discountCost"
			value="#{plc.calculation.premiumCost * (1 - discountData.discountValue)}">
			<f:convertNumber type="currency" locale="kk_KZ" maxFractionDigits="0"
				groupingUsed="true" currencySymbol="&#8376;" />
		</h:outputText>

		<h:panelGroup styleClass="policyCostButton">
			<p:button value="#{gpovts['command.close-dialog']}"
				onclick="PF('costDialog').hide(); return false;" />
		</h:panelGroup>
	</p:dialog>

</ui:composition>