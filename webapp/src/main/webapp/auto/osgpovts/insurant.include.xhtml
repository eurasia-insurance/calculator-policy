<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:comp="http://xmlns.jcp.org/jsf/composite"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

	<h:panelGroup id="insurantPanel">

		<p:panel header="#{gpovts['title.insurant.who-is-insurant']}">
			<p:message for="whoIsInsurant" />
			<p:selectOneRadio id="whoIsInsurant"
				value="#{osgpovtsView.policy.insurant.whoIsInsurant}">
				<f:selectItem itemValue="DRIVER"
					itemLabel="#{gpovts['label.si.who-is-insurant.DRIVER']}" />
				<f:selectItem itemValue="OTHER"
					itemLabel="#{gpovts['label.si.who-is-insurant.OTHER']}" />
				<p:ajax listener="#{osgpovtsView.onWhoIsInsurantChanged}"
					event="change" process="@this" update="insurantPanel" />
			</p:selectOneRadio>
		</p:panel>

		<p:panel header="#{gpovts['label.input.insurant.driver-as-insurant']}"
			rendered="#{osgpovtsView.policy.insurant.whoIsInsurant eq 'DRIVER' and fn:length(osgpovtsView.policy.insuredDrivers) gt 1}">
			<p:message for="driverAsInsurantSelect" />
			<p:selectOneRadio id="driverAsInsurantSelect"
				value="#{osgpovtsView.policy.insurant.driverAsInsurant}" var="c"
				converter="#{insuredDriverDataConverter}" layout="grid" columns="1">
				<f:selectItems value="#{osgpovtsView.policy.insuredDrivers}"
					var="drv"
					itemLabel="#{drv.personalData.displayName} (#{glb['label.input.id-number']} : #{drv.idNumber})"
					itemValue="#{drv}" />
				<p:ajax listener="#{osgpovtsView.onDriverAsInsurantSelected}"
					process="@this" update="@this,insurantPanel" />
			</p:selectOneRadio>
		</p:panel>

		<h:panelGroup
			rendered="#{osgpovtsView.policy.insurant.whoIsInsurant eq 'OTHER'}">
			<p:panel header="#{gpovts['title.insurant.personal-data']}">
				<h:panelGrid columns="1">
					<p:outputLabel value="#{gpovts['label.input.insurant.id-number']}" />
					<h:panelGrid columns="2">
						<p:inputMask id="insurantIdNumber"
							value="#{osgpovtsView.policy.insurant.idNumber}"
							mask="999999999999" onchange="rcInsurantIdNumberChanged()">
							<pe:keyFilter regEx="/[0123456789]/i" preventPaste="false" />
						</p:inputMask>
						<p:message for="insurantIdNumber" display="icon" />
						<p:remoteCommand name="rcInsurantIdNumberChanged"
							actionListener="#{osgpovtsView.onInsurantIdNumberChanged}"
							process="@this,insurantIdNumber" update="@this,insurantPanel" />
					</h:panelGrid>
				</h:panelGrid>
				<h:panelGrid columns="5">
					<p:outputLabel value="#{glb['label.personal-data.surename']}" />
					<p:outputLabel value="#{glb['label.personal-data.name']}" />
					<p:outputLabel value="#{glb['label.personal-data.patronymic']}" />
					<p:outputLabel value="#{glb['label.personal-data.day-of-birth']}" />
					<p:outputLabel value="#{glb['label.personal-data.sex']}" />
					<h:panelGrid columns="2">
						<p:inputText id="surename"
							value="#{osgpovtsView.policy.insurant.personalData.surename}"
							disabled="#{osgpovtsView.policy.insurant.fetched and not empty osgpovtsView.policy.insurant.personalData.surename}">
							<p:ajax event="change" process="@this"
								update="@this,insurantPanel" />
						</p:inputText>
						<p:message for="surename" display="icon" />
					</h:panelGrid>
					<h:panelGrid columns="2">
						<p:inputText id="name"
							value="#{osgpovtsView.policy.insurant.personalData.name}"
							disabled="#{osgpovtsView.policy.insurant.fetched and not empty osgpovtsView.policy.insurant.personalData.name}">
							<p:ajax event="change" process="@this"
								update="@this,insurantPanel" />
						</p:inputText>
						<p:message for="name" display="icon" />
					</h:panelGrid>
					<h:panelGrid columns="2">
						<p:inputText id="patronymic"
							value="#{osgpovtsView.policy.insurant.personalData.patronymic}"
							disabled="#{osgpovtsView.policy.insurant.fetched and not empty osgpovtsView.policy.insurant.personalData.patronymic}">
							<p:ajax event="change" process="@this"
								update="@this,insurantPanel" />
						</p:inputText>
						<p:message for="patronymic" display="icon" />
					</h:panelGrid>
					<h:panelGrid columns="2">
						<p:calendar id="dayOfBirth"
							value="#{osgpovtsView.policy.insurant.personalData.dayOfBirth}"
							disabled="#{osgpovtsView.policy.insurant.fetched and not empty osgpovtsView.policy.insurant.personalData.dayOfBirth }">
							<p:ajax event="change" process="@this"
								update="@this,insurantPanel" />
							<p:ajax event="dateSelect" process="@this"
								update="@this,insurantPanel" />
						</p:calendar>
						<p:message for="dayOfBirth" display="icon" />
					</h:panelGrid>
					<h:panelGrid columns="2">
						<p:selectOneRadio id="sex"
							value="#{osgpovtsView.policy.insurant.personalData.sex}"
							disabled="#{osgpovtsView.policy.insurant.fetched and osgpovtsView.policy.insurant.personalData.sex ne 'UNSPECIFIED'}">
							<p:ajax event="change" process="@this"
								update="@this,insurantPanel" />
							<f:selectItems value="#{sexService.selectableItemsSI}" />
						</p:selectOneRadio>
						<p:message for="sex" display="icon" />
					</h:panelGrid>
				</h:panelGrid>
			</p:panel>

			<p:panel header="#{glb['label.identity-card-data']}">
				<h:panelGrid columns="4">
					<p:outputLabel value="#{glb['label.identity-card-data.type']}" />
					<p:outputLabel value="#{glb['label.identity-card-data.number']}" />
					<p:outputLabel
						value="#{glb['label.identity-card-data.issuing-authority']}" />
					<p:outputLabel
						value="#{glb['label.identity-card-data.date-of-issue']}" />
					<h:panelGrid columns="2">
						<p:selectOneMenu id="identityCardDataType"
							value="#{osgpovtsView.policy.insurant.identityCardData.type}"
							disabled="#{osgpovtsView.policy.insurant.fetched and osgpovtsView.policy.insurant.identityCardData.type ne 'UNSPECIFIED'}">
							<p:ajax event="change" process="@this"
								update="@this,insurantPanel" />
							<f:selectItems
								value="#{identityCardTypeService.selectableItemsSI}" />
						</p:selectOneMenu>
						<p:message for="identityCardDataType" display="icon" />
					</h:panelGrid>
					<h:panelGrid columns="2">
						<p:inputText id="identityCardDataNumber"
							value="#{osgpovtsView.policy.insurant.identityCardData.number}"
							disabled="#{osgpovtsView.policy.insurant.fetched and not empty osgpovtsView.policy.insurant.identityCardData.number}">
							<p:ajax event="change" process="@this"
								update="@this,insurantPanel" />
						</p:inputText>
						<p:message for="identityCardDataNumber" display="icon" />
					</h:panelGrid>
					<h:panelGrid columns="2">
						<p:inputText id="identityCardIssuingAuthority"
							value="#{osgpovtsView.policy.insurant.identityCardData.issuingAuthority}"
							disabled="#{osgpovtsView.policy.insurant.fetched and not empty osgpovtsView.policy.insurant.identityCardData.issuingAuthority}">
							<p:ajax event="change" process="@this"
								update="@this,insurantPanel" />
						</p:inputText>
						<p:message for="identityCardIssuingAuthority" display="icon" />
					</h:panelGrid>
					<h:panelGrid columns="2">
						<p:calendar id="identityCardDateOfIssue"
							value="#{osgpovtsView.policy.insurant.identityCardData.dateOfIssue}"
							locale="#{localeService.locale}"
							disabled="#{osgpovtsView.policy.insurant.fetched and not empty osgpovtsView.policy.insurant.identityCardData.dateOfIssue}">
							<p:ajax event="change" process="@this"
								update="@this,insurantPanel" />
							<p:ajax event="dateSelect" process="@this"
								update="@this,insurantPanel" />
						</p:calendar>
						<p:message for="identityCardDateOfIssue" display="icon" />
					</h:panelGrid>
				</h:panelGrid>
			</p:panel>

			<p:panel header="#{glb['label.residence-data']}">
				<h:panelGrid columns="2">
					<p:outputLabel value="#{glb['label.residence-data.city']}" />
					<p:outputLabel value="#{glb['label.residence-data.address']}" />
					<h:panelGrid columns="2">
						<p:selectOneMenu id="city"
							value="#{osgpovtsView.policy.insurant.residenceData.city}"
							filter="true" filterMatchMode="contains" var="c"
							disabled="#{osgpovtsView.policy.insurant.fetched and osgpovtsView.policy.insurant.residenceData.city ne 'UNSPECIFIED'}">
							<f:selectItems value="#{kzCityService.selectableItemsSI}" />
							<p:column>
								<h:outputText value="#{c}" />
							</p:column>
							<p:column>
								<h:outputText value="#{c.rusname}" />
							</p:column>
							<p:ajax event="change" process="@this"
								update="@this,insurantPanel" />
						</p:selectOneMenu>
						<p:message for="city" display="icon" />
					</h:panelGrid>
					<h:panelGrid columns="2">
						<p:inputText id="address"
							value="#{osgpovtsView.policy.insurant.residenceData.address}"
							disabled="#{osgpovtsView.policy.insurant.fetched and not empty osgpovtsView.policy.insurant.residenceData.address}">
							<p:ajax event="change" process="@this"
								update="@this,insurantPanel" />
						</p:inputText>
						<p:message for="address" display="icon" />
					</h:panelGrid>
				</h:panelGrid>

				<p:selectBooleanCheckbox
					value="#{osgpovtsView.policy.insurant.residenceData.resident}"
					widgetVar="w_isResident#{osgpovtsView.policy.insurant.safeId}"
					disabled="#{osgpovtsView.policy.insurant.fetched}">
					<p:ajax event="change" process="@this" update="@this,insurantPanel" />
				</p:selectBooleanCheckbox>
				<p:outputLabel value="#{glb['label.residence-data.is-resident']}"
					onclick="PF('w_isResident#{osgpovtsView.policy.insurant.safeId}').toggle()" />

				<h:panelGrid columns="1"
					rendered="#{not osgpovtsView.policy.insurant.residenceData.resident}">
					<p:outputLabel value="#{glb['label.origin-data.country']}" />
					<h:panelGrid columns="2">
						<p:selectOneMenu id="country"
							value="#{osgpovtsView.policy.insurant.originData.country}"
							filter="true" filterMatchMode="contains" var="c"
							disabled="#{osgpovtsView.policy.insurant.fetched and osgpovtsView.policy.insurant.originData.country ne 'UNSPECIFIED'}">
							<f:selectItems value="#{countryService.selectableItemsSI}" />
							<p:column>
								<h:outputText value="#{c}" />
							</p:column>
							<p:column>
								<h:outputText value="#{c.isoCode}" />
							</p:column>
							<p:column>
								<h:outputText value="#{c.rusname}" />
							</p:column>
							<p:ajax event="change" process="@this"
								update="@this,insurantPanel" />
						</p:selectOneMenu>
						<p:message for="country" display="icon" />
					</h:panelGrid>
				</h:panelGrid>
			</p:panel>
		</h:panelGroup>

		<p:panel header="#{glb['title.contact-data']}">
			<h:panelGrid columns="3">
				<p:outputLabel value="#{glb['label.input.contact-data.phone']}" />
				<p:outputLabel value="#{glb['label.input.contact-data.email']}" />
				<p:outputLabel value="#{glb['label.input.contact-data.site-url']}" />
				<h:panelGrid columns="2">
					<h:panelGroup>
						<p:inputMask mask="+7 (999) 999-99-99" id="contactDataPhone"
							value="#{osgpovtsView.policy.insurant.contactData.phone}"
							onchange="rc_ContactDataPhoneChanged()" />
						<p:remoteCommand name="rc_ContactDataPhoneChanged"
							process="contactDataPhone" update="@this,insurantPanel" />
					</h:panelGroup>
					<p:message for="contactDataPhone" display="icon" />
				</h:panelGrid>
				<h:panelGrid columns="2">
					<p:inputText id="contactDataEmail"
						value="#{osgpovtsView.policy.insurant.contactData.email}">
						<p:ajax event="change" process="@this"
							update="@this,insurantPanel" />
					</p:inputText>
					<p:message for="contactDataEmail" display="icon" />
				</h:panelGrid>
				<h:panelGrid columns="2">
					<p:inputText id="contactDataSiteUrl"
						value="#{osgpovtsView.policy.insurant.contactData.siteUrl}">
						<p:ajax event="change" process="@this"
							update="@this,insurantPanel" />
					</p:inputText>
					<p:message for="contactDataSiteUrl" display="icon" />
				</h:panelGrid>
			</h:panelGrid>
		</p:panel>

	</h:panelGroup>
</ui:composition>