<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:comp="http://xmlns.jcp.org/jsf/composite"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">


	<p:accordionPanel value="#{osgpovtsView.policy.insuredDrivers}"
		var="driver">
		<p:tab
			title="#{empty driver.displayName ? gpovts['title.insuted-driver.default-name'] : driver.displayName}">
			<h:panelGroup id="currentDriverPanel">
				<h:panelGrid columns="5" s1tyle="width: 100%;">
					<p:outputLabel value="#{glb['label.personal-data.surename']}" />
					<p:outputLabel value="#{glb['label.personal-data.name']}" />
					<p:outputLabel value="#{glb['label.personal-data.patronymic']}" />
					<p:outputLabel value="#{glb['label.personal-data.day-of-birth']}" />
					<p:outputLabel value="#{glb['label.personal-data.sex']}" />
					<h:panelGrid columns="2">
						<p:inputText id="surename" value="#{driver.personalData.surename}"
							disabled="#{driver.fetched and not empty driver.personalData.surename}">
							<p:ajax event="change" process="@this"
								update="@this, currentDriverPanel" />
						</p:inputText>
						<p:message for="surename" display="icon" />
					</h:panelGrid>
					<h:panelGrid columns="2">
						<p:inputText id="name" value="#{driver.personalData.name}"
							disabled="#{driver.fetched and not empty driver.personalData.name}">
							<p:ajax event="change" process="@this"
								update="@this, currentDriverPanel" />
						</p:inputText>
						<p:message for="name" display="icon" />
					</h:panelGrid>
					<h:panelGrid columns="2">
						<p:inputText id="patronymic"
							value="#{driver.personalData.patronymic}"
							disabled="#{driver.fetched and not empty driver.personalData.patronymic}">
							<p:ajax event="change" process="@this"
								update="@this, currentDriverPanel" />
						</p:inputText>
						<p:message for="patronymic" display="icon" />
					</h:panelGrid>
					<h:panelGrid columns="2">
						<p:calendar id="dayOfBirth"
							value="#{driver.personalData.dayOfBirth}"
							disabled="#{driver.fetched and not empty driver.personalData.dayOfBirth}">
							<p:ajax event="change" process="@this"
								update="@this, currentDriverPanel" />
						</p:calendar>
						<p:message for="dayOfBirth" display="icon" />
					</h:panelGrid>
					<h:panelGrid columns="2">
						<p:selectOneRadio id="sex" value="#{driver.personalData.sex}"
							disabled="#{driver.fetched and not empty driver.personalData.sex and driver.personalData.sex ne 'UNSPECIFIED'}">
							<p:ajax event="change" process="@this"
								update="@this, currentDriverPanel" />
							<f:selectItems value="#{sexService.validItemsSI}" />
						</p:selectOneRadio>
						<p:message for="sex" display="icon" />
					</h:panelGrid>
				</h:panelGrid>

				<p:panel header="#{glb['label.residence-data']}">
					<h:panelGrid columns="2">
						<p:outputLabel value="#{glb['label.residence-data.city']}" />
						<p:outputLabel value="#{glb['label.residence-data.address']}" />
						<h:panelGrid columns="2">
							<p:selectOneMenu id="city" value="#{driver.residenceData.city}"
								filter="true" filterMatchMode="contains" var="c">
								<f:selectItems value="#{kzCityService.allItemsSI}" />
								<p:column>
									<h:outputText value="#{c}" />
								</p:column>
								<p:column>
									<h:outputText value="#{c.rusname}" />
								</p:column>
								<p:ajax event="change" process="@this"
									update="@this, currentDriverPanel" />
							</p:selectOneMenu>
							<p:message for="city" display="icon" />
						</h:panelGrid>
						<h:panelGrid columns="2">
							<p:inputText id="address" value="#{driver.residenceData.address}">
								<p:ajax event="change" process="@this"
									update="@this, currentDriverPanel" />
							</p:inputText>
							<p:message for="address" display="icon" />
						</h:panelGrid>
					</h:panelGrid>

					<p:selectBooleanCheckbox widgetVar="w_isResident#{driver.safeId}"
						value="#{driver.residenceData.resident}">
						<p:ajax event="change" process="@this"
							update="@this, currentDriverPanel" />
					</p:selectBooleanCheckbox>
					<p:outputLabel value="#{glb['label.residence-data.is-resident']}"
						onclick="PF('w_isResident#{driver.safeId}').toggle()" />

					<h:panelGrid columns="1"
						rendered="#{not driver.residenceData.resident}">
						<p:outputLabel value="#{glb['label.origin-data.country']}" />
						<h:panelGrid columns="2">
							<p:selectOneMenu id="country"
								value="#{driver.originData.country}" filter="true"
								filterMatchMode="contains" var="c">
								<f:selectItems value="#{countryService.validItemsSI}" />
								<p:column>
									<h:outputText value="#{c}" />
								</p:column>
								<p:column>
									<h:outputText value="#{c.isoCode}" />
								</p:column>
								<p:column>
									<h:outputText value="#{c.rusname}" />
								</p:column>
								<p:ajax event="change" process="@this"
									update="@this, currentDriverPanel" />
							</p:selectOneMenu>
							<p:message for="country" display="icon" />
						</h:panelGrid>
					</h:panelGrid>
				</p:panel>

				<p:panel header="#{glb['label.identity-card-data']}">
					<h:panelGrid columns="4">
						<p:outputLabel value="#{glb['label.identity-card-data.type']}" />
						<p:outputLabel value="#{glb['label.identity-card-data.number']}" />
						<p:outputLabel
							value="#{glb['label.identity-card-data.issuing-authority']}" />
						<p:outputLabel
							value="#{glb['label.identity-card-data.date-of-issue']}" />
						<h:panelGrid columns="2">
							<p:selectOneMenu id="identityCardDataType"
								value="#{driver.identityCardData.type}">
								<p:ajax event="change" process="@this"
									update="@this, currentDriverPanel" />
								<f:selectItems value="#{identityCardTypeService.allItemsSI}" />
							</p:selectOneMenu>
							<p:message for="identityCardDataType" display="icon" />
						</h:panelGrid>
						<h:panelGrid columns="2">
							<p:inputText id="identityCardDataNumber"
								value="#{driver.identityCardData.number}">
								<p:ajax event="change" process="@this"
									update="@this, currentDriverPanel" />
							</p:inputText>
							<p:message for="identityCardDataNumber" display="icon" />
						</h:panelGrid>
						<h:panelGrid columns="2">
							<p:inputText id="identityCardIssuingAuthority"
								value="#{driver.identityCardData.issuingAuthority}">
								<p:ajax event="change" process="@this"
									update="@this, currentDriverPanel" />
							</p:inputText>
							<p:message for="identityCardIssuingAuthority" display="icon" />
						</h:panelGrid>
						<h:panelGrid columns="2">
							<p:calendar id="identityCardDateOfIssue"
								value="#{driver.identityCardData.dateOfIssue}"
								locale="#{localeService.locale}">
								<p:ajax event="change" process="@this"
									update="@this, currentDriverPanel" />
							</p:calendar>
							<p:message for="identityCardDateOfIssue" display="icon" />
						</h:panelGrid>
					</h:panelGrid>
					<p:outputLabel
						value="#{glb['label.identity-card-data.scan-files']}" />
					<p:panel id="identityCardGalleria" styleClass="ui-glr ui-widget">
						<p:remoteCommand name="rc_NewIdentityCardUploaded#{driver.safeId}"
							action="#{osgpovtsView.onDriverIdentityCardImageUploaded(driver)}"
							process="@this" update="@this, identityCardGalleria" />
						<ui:repeat var="image"
							value="#{driver.identityCardData.scanFiles}">
							<p:commandLink
								action="#{osgpovtsView.removeDriverIdentityCardImage(driver, image)}"
								ajax="true" process="@this"
								update="@this, @form(identityCardGalleria)">
								<p:graphicImage value="#{uploadedImageService.content}"
									styleClass="ui-glr-image ui-glr-item ui-widget-content">
									<f:param name="id" value="#{image.id}" />
								</p:graphicImage>
							</p:commandLink>
						</ui:repeat>
						<p:fileUpload mode="advanced"
							styleClass="ui-glr-add ui-glr-item ui-widget-content"
							allowTypes="/(\.|\/)(gif|jpe?g|png)$/" multiple="true"
							sizeLimit="1000000" fileLimit="10" skinSimple="true" auto="true"
							fileUploadListener="#{uploadedImageService.onImageUpload}"
							oncomplete="rc_NewIdentityCardUploaded#{driver.safeId}()" />
					</p:panel>
				</p:panel>
				<p:panel header="#{gpovts['label.driver-license-data']}">
					<h:panelGrid columns="2">
						<p:outputLabel
							value="#{gpovts['label.driver-license-data.number']}" />
						<p:outputLabel
							value="#{gpovts['label.driver-license-data.date-of-issue']}" />
						<h:panelGrid columns="2">
							<p:inputText id="driverLicenseNumber"
								value="#{driver.driverLicenseData.number}">
								<p:ajax event="change" process="@this"
									update="@this, currentDriverPanel" />
							</p:inputText>
							<p:message for="driverLicenseNumber" display="icon" />
						</h:panelGrid>
						<h:panelGrid columns="2">
							<p:calendar id="driverLicenseDateOfIssue"
								value="#{driver.driverLicenseData.dateOfIssue}"
								locale="#{localeService.locale}">
								<p:ajax event="change" process="@this"
									update="@this, currentDriverPanel" />
							</p:calendar>
							<p:message for="driverLicenseDateOfIssue" display="icon" />
						</h:panelGrid>
					</h:panelGrid>
					<p:outputLabel
						value="#{gpovts['label.driver-license-data.scan-files']}" />
					<p:panel id="driverLicenseGalleria" styleClass="ui-glr ui-widget">
						<p:remoteCommand
							name="rc_NewDriverLicenseUploaded#{driver.safeId}"
							action="#{osgpovtsView.onDriverLicenseImageUploaded(driver)}"
							process="@this" update="@this, driverLicenseGalleria" />
						<ui:repeat var="image"
							value="#{driver.driverLicenseData.scanFiles}">
							<p:commandLink
								action="#{osgpovtsView.removeDriverLicenseImage(driver, image)}"
								ajax="true" process="@this"
								update="@this, @form(driverLicenseGalleria)">
								<p:graphicImage value="#{uploadedImageService.content}"
									styleClass="ui-glr-image ui-glr-item ui-widget-content">
									<f:param name="id" value="#{image.id}" />
								</p:graphicImage>
							</p:commandLink>
						</ui:repeat>
						<p:fileUpload mode="advanced"
							styleClass="ui-glr-add ui-glr-item ui-widget-content"
							allowTypes="/(\.|\/)(gif|jpe?g|png)$/" multiple="true"
							sizeLimit="1000000" fileLimit="10" skinSimple="true" auto="true"
							fileUploadListener="#{uploadedImageService.onImageUpload}"
							oncomplete="rc_NewDriverLicenseUploaded#{driver.safeId}()">
						</p:fileUpload>
					</p:panel>
				</p:panel>

			</h:panelGroup>
		</p:tab>
	</p:accordionPanel>


</ui:composition>